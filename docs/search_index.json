[["les-types-de-cartes.html", "Chapitre 2 Les types de cartes 2.1 Les données d’exemple 2.2 Afficher un fond de carte 2.3 Carte de symboles proportionnels 2.4 Carte choroplèthe 2.5 Carte de typologie 2.6 Carte de stocks et de ratios 2.7 Carte de stocks et de catégories", " Chapitre 2 Les types de cartes La fonction mf_map() est la fonction centrale du package mapsf. Elle permet de réaliser la plupart des représentations usuelles en cartographie. Ces arguments principaux sont : x, un objet sf ; var, le nom de la variable à représenter ; type, le type de représentation. 2.1 Les données d’exemple Les lignes suivantes importent les couches d’information spatiales situées dans le fichier geopackage lot46.gpkg. library(sf) # import des communes du Lot com &lt;- st_read(&quot;data/lot46.gpkg&quot;, layer = &quot;commune&quot;, quiet = TRUE) # import des départments français dep &lt;- st_read(&quot;data/lot46.gpkg&quot;, layer = &quot;departement&quot;, quiet = TRUE) # import des restaurants resto &lt;- st_read(&quot;data/lot46.gpkg&quot;, layer = &quot;restaurant&quot;, quiet = TRUE) # import des routes route &lt;- st_read(&quot;data/lot46.gpkg&quot;, layer = &quot;route&quot;, quiet = TRUE) 2.2 Afficher un fond de carte Utilisée sans précision de type, la fonction mf_map() affiche simplement le fond de carte. library(mapsf) # Communes mf_map(x = com, border = &quot;white&quot;) mf_map(x = dep, lwd = 2, col = NA, add = TRUE) mf_map(x = route, lwd = .5, col = &quot;ivory4&quot;, add = TRUE) mf_map(x = resto, pch = 20, cex = .7, col = &quot;darkred&quot;, add = TRUE) 2.3 Carte de symboles proportionnels Les cartes de symboles proportionnels sont utilisées pour représenter les variables de stocks (variables quantitatives absolues, la somme et la moyenne ont un sens). La fonction mf_map(..., type = \"prop\") propose cette représentation. # Communes mf_map(x = com) # Symboles proportionnels mf_map( x = com, var = &quot;POPULATION&quot;, type = &quot;prop&quot;, leg_title = &quot;Population totale\\n(2015)&quot; ) # Titre mf_title(&quot;Distribution de la population dans le Lot&quot;) 2.3.1 Comparer plusieurs cartes Il est possible de fixer les dimensions du plus grand symbole correspondant à une certaine valeur avec les arguments inches et val_max. Nous pouvons ainsi construire des cartes en symboles proportionnels comparables. # Afficher deux cartes en vis-à-vis par(mfrow = c(1,2)) # Communes mf_map(x = com, border = &quot;grey90&quot;, lwd = .5) # Population active occupée dans l&#39;industrie, les hommes mf_map( x = com, var = &quot;IND_H&quot;, type = &quot;prop&quot;, inches = .2, val_max = 600, leg_title = &quot;Hommes&quot;, leg_val_cex = .5, ) # ajout d&#39;un titre mf_title(&quot;Population active occupée dans l&#39;industrie&quot;) # Communes mf_map(x = com, border = &quot;grey90&quot;, lwd = .5) # Population active occupée dans l&#39;industrie, les femmes mf_map( x = com, var = &quot;IND_F&quot;, type = &quot;prop&quot;, inches = .2, val_max = 600, leg_title =&quot;Femmes&quot;, leg_val_cex = .5 ) # ajout d&#39;un titre mf_title(&quot;Population active occupée dans l&#39;industrie&quot;) Nous avons ici affiché deux cartes en vis-à-vis, voir le point Afficher plusieurs cartes sur la même figure pour plus de détails. 2.4 Carte choroplèthe Les cartes choroplèthes sont utilisées pour représenter les variables de ratios (variables quantitatives relatives, la moyenne a un sens, la somme n’a pas de sens). Pour ce genre de représentation il faut au préalable : choisir une méthode de discrétisation pour transformer une série statistique continue en classes définies par des intervalles, choisir un nombre de classes, choisir une palette de couleurs. La fonction mf_map(..., type = \"choro\") permet de créer des cartes choroplètes. Les arguments nbreaks et breaks servent à paramétrer les discrétisations, et la fonction mf_get_breaks() permet de travailler sur les discrétisations en dehors de la fonction mf_map(). De même, l’argument pal est utilisé pour renseigner une palette de couleur, mais plusieurs fonctions peuvent être utilisées pour paramétrer les palettes en dehors de la fonction (mf_get_pal…). # Densité de population (hab./km2) en utilisant la fonction sf::st_area() com$DENS &lt;- 1e6 * com$POP / as.numeric(st_area(com)) mf_map( x = com, var = &quot;DENS&quot;, type = &quot;choro&quot;, breaks = &quot;quantile&quot;, pal = &quot;Dark Mint&quot;, lwd = 1, leg_title = &quot;Densité de population\\n(habitants par km2)&quot;, leg_val_rnd = 0 ) mf_title(&quot;Distribution de la population dans le Lot (2018)&quot;) 2.4.1 Discrétisations La fonction mf_get_breaks() met à disposition les méthodes de discrétisations de variables classique : quantiles, moyenne/écart-type, amplitudes égales, moyennes emboîtées, Fisher-Jenks, géométrique … com$POP_ACT &lt;- com$AGR_H + com$AGR_F + com$IND_H + com$IND_F + com$BTP_H + com$BTP_F + com$TER_H + com$TER_F com$SHARE_ACT &lt;- 100 * com$POP_ACT / com$POPULATION d1 &lt;- mf_get_breaks(com$SHARE_ACT, nbreaks = 6, breaks = &quot;equal&quot;, freq = T) d2 &lt;- mf_get_breaks(com$SHARE_ACT, nbreaks = 6, breaks = &quot;quantile&quot;) d3 &lt;- mf_get_breaks(com$SHARE_ACT, nbreaks = 6, breaks = &quot;geom&quot;) d4 &lt;- mf_get_breaks(com$SHARE_ACT, breaks = &quot;msd&quot;, central = FALSE) 2.4.2 Palettes de couleurs L’argument pal de mf_map() est dédié au choix d’une palette de couleur. Les palettes fournies par la fonction hcl.colors() peuvent être utilisées directement. mf_map(x = com, var = &quot;SHARE_ACT&quot;, type = &quot;choro&quot;, breaks = d4, pal = &quot;Blues 3&quot;) Figure 2.1: Palettes directement disponibles La fonction mf_get_pal() permet de construire une palette de couleur. Cette fonction est surtout utile pour créer des palettes divergentes asymétriques équilibrées. mypal &lt;- mf_get_pal(n = c(6,3), palette = c(&quot;Burg&quot;, &quot;Teal&quot;)) image(1:9, 1, as.matrix(1:9), col=mypal, xlab = &quot;&quot;, ylab = &quot;&quot;, xaxt = &quot;n&quot;, yaxt = &quot;n&quot;,bty = &quot;n&quot;) 2.4.3 Pour une couche de points Il est possible d’utiliser ce mode de représentation en implémentation ponctuelle également. com_c &lt;- st_centroid(com) mf_map(com) mf_map( x = com_c, var = &quot;DENS&quot;, type = &quot;choro&quot;, breaks = &quot;quantile&quot;, nbreaks = 4, pal = &quot;Dark Mint&quot;, pch = 24, cex = 2, border = &quot;white&quot;, lwd = .7, leg_pos = &quot;topleft&quot;, leg_title = &quot;Densité de population\\n(habitants par km2)&quot;, leg_val_rnd = 0, add = TRUE ) mf_title(&quot;Distribution de la population dans le Lot (2018)&quot;) 2.5 Carte de typologie Les cartes de typologies sont utilisées pour représenter les variables qualitatives. La fonction mf_map(..., type = \"typo\") propose cette représentation. mf_map( x = com, var=&quot;STATUT&quot;, type = &quot;typo&quot;, pal = c(&quot;aquamarine4&quot;, &quot;yellow3&quot;,&quot;wheat&quot;), lwd = .7, leg_title = &quot;&quot; ) mf_title(&quot;Statut Administratif&quot;) 2.5.1 Ordonner les valeurs dans la légende L’argument val_order sert à ordonner les modalités dans la légende. mf_map( x = com, var=&quot;STATUT&quot;, type = &quot;typo&quot;, pal = c(&quot;aquamarine4&quot;, &quot;yellow3&quot;,&quot;wheat&quot;), val_order = c(&quot;Préfecture&quot;, &quot;Sous-préfecture&quot;, &quot;Commune simple&quot;), lwd = .7, leg_title = &quot;&quot; ) mf_title(&quot;Statut Administratif&quot;) 2.5.2 Les cartes de points Quand l’implantation de la couche est ponctuelle, des symboles sont utilisés pour porter les couleurs de la typologie. # extraction des centroides de la préfectures et des sous-préfectures com_ctr &lt;- st_centroid(com[com$STATUT != &quot;Commune simple&quot;, ]) mf_map(com) mf_map( x = com_ctr, var = &quot;STATUT&quot;, type = &quot;typo&quot;, cex = 3, pch = 23, pal = c(&quot;aquamarine4&quot;, &quot;yellow3&quot;), leg_title = &quot;&quot;, add = TRUE ) mf_title(&quot;Statut Administratif&quot;) 2.5.3 Les cartes de lignes # Sélection des routes qui intersectent la commune de Cahors cahors &lt;- com[com$NOM_COM == &quot;Cahors&quot;, ] route_cahors &lt;- route[st_intersects(x = route, y = cahors, sparse = FALSE), ] mf_map(cahors) mf_map( x = route_cahors, var = &quot;VOCATION&quot;, type = &quot;typo&quot;, lwd = 2, pal = mf_get_pal(n = 4, &quot;Dark 2&quot;), leg_title = &quot;Type de route&quot;, add = TRUE ) mf_title(&quot;Statut Administratif&quot;) 2.6 Carte de stocks et de ratios La fonction mf_map(..., var = c(\"var1\", \"var2\"), type = \"prop_choro\") représente des symboles proportionnels dont les surfaces sont proportionnelles aux valeurs d’une variable et dont la couleur repose sur la discrétisation d’une seconde variable. La fonction utilise les arguments des fonctions mf_map(..., type = \"prop\") et mf_map(..., type = \"choro\"). mf_map(x = com) mf_map( x = com, var = c(&quot;POPULATION&quot;, &quot;DENS&quot;), type = &quot;prop_choro&quot;, border = &quot;grey50&quot;, lwd = 1, leg_pos = c(&quot;topright&quot;, &quot;topleft&quot;), leg_title = c(&quot;Population&quot;, &quot;Densité\\nde population\\n(en hab./km2)&quot;), breaks = &quot;q6&quot;, pal = &quot;Magenta&quot;, leg_val_rnd = c(0,1)) mf_title(&quot;Population&quot;) 2.7 Carte de stocks et de catégories La fonction mf_map(..., var = c(\"var1\", \"var2\"), type = \"prop_typo\") représente des symboles proportionnels dont les surfaces sont proportionnelles aux valeurs d’une variable et dont la couleur représente les modalités d’une variable qualitative. La fonction utilise les arguments des fonctions mf_map(..., type = \"prop\") et mf_map(..., type = \"typo\"). mf_map(x = com) mf_map( x = com, var = c(&quot;POPULATION&quot;, &quot;STATUT&quot;), type = &quot;prop_typo&quot;, pal = c(&quot;aquamarine4&quot;, &quot;yellow3&quot;,&quot;wheat&quot;), val_order = c(&quot;Préfecture&quot;, &quot;Sous-préfecture&quot;, &quot;Commune simple&quot;), leg_pos = c(&quot;bottomleft&quot;,&quot;topleft&quot;), leg_title = c(&quot;Population\\n(2015)&quot;, &quot;Statut administratif&quot;), ) mf_title(&quot;Population&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
